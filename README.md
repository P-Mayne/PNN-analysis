# PNN-analysis
Pipeline for PNN analysis 
This pipeline was developed for PNN analysis but can be adapted to analyse all types of immunohistochemical stains. ImageJ codes are available in each Step folder to aid in image batch processing. 
Images taken from an epifluorescent microscope are first segmented using ROIs of interest that correspond to the Allen Brain Atlas (Step 1). 
To minimise background signal, the images were converted to 32-bit and outside the ROI was set to not a number (Step 2). This ensured that any area outside the ROI did not influence background subtraction. Background subtraction was then applied using a math correction algorithm in ImageJ: setMinAndMax(med, (mean+(x*std))-y) where x is an integer value to raise the maximum intensity and y is a pixel value to subtract unwanted background (Step 3). Using this math function was a way to normalise all the images in the dataset. Integers x and y were set values used for all images in the dataset. Other background subtraction and filtering methods can be used as well.
Install Cellpose using Anaconda and experiment with cell segmentation methods available in the cell zoo. If none suit, you can train your own model using very few images. This method has also been published by Stringer and Pachitariu 2022 (https://www.biorxiv.org/content/10.1101/2022.04.01.486764v1.full.pdf). Step 4 folder has information on how to use the code to batch-process the images. 
Masks in the form of .tiff images are saved from cellpose and are then thresholded in imageJ (step 5). From here Cellprofiler can be used to profile cells and degree of colocalisation with other cell types (Step 6 - Option 2). If you are only interested in the cell count of one stain, please use Option 1. Cell ROIs are segmented using the "Analyse Particles" function in imageJ (Step 6 - Option 1) and these ROIs are then overlayed onto the original 16-bit tiff images to extract 
